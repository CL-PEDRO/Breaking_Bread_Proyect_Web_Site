<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Dynamic Search Interface</title>
   <link rel="stylesheet" href="../css/generalStyles.css">
   <style>



        .main-container{
            display: flex;
            width: 1500px;
            justify-content: flex-end;
            gap: 20px;
            padding: 20px;
        }
       body {
           font-family: 'Arial', sans-serif;
           margin: 0;
           padding: 0;
           background-color: #f0f2f5;
           color: #333;
       }
       .header {
           display: flex;
           justify-content: space-between;
           align-items: center;
           background-color: #ffffff;
           color: black;
           padding: 10px 20px;
           box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
           position: sticky;
           top: 0;
           z-index: 1000;
       }
       .header .logo {
           display: flex;
           align-items: center;
           font-size: 20px;
           font-weight: bold;
       }
       .header .logo img {
           height: 40px;
           margin-right: 10px;
       }
       .header .navegation {
           display: flex;
           align-items: center;
       }
       .header .navegation .nav-links {
           list-style: none;
           display: flex;
           margin: 0;
           padding: 0;
       }
       .header .navegation .nav-links li {
           margin: 0 15px;
       }
       .header .navegation .nav-links a {
           color: black;
           text-decoration: none;
           font-weight: 500;
           font-size: 16px;
       }
       .header .navegation .nav-links a:hover {
           text-decoration: none;
           padding: 5px;
           background-color: #810909;
           color: #fff;
           margin: 10px;
           border-radius: 5px;
       }
       .header .search-bar {
           display: none;
       }
       .header .search-bar.active {
           display: flex;
       }
       .header .search-bar input {
           padding: 10px;
           border: 1px solid #ccc;
           border-radius: 8px;
           font-size: 16px;
           margin-left: 20px;
       }

       .main-content {
           width: 1000px;
           margin: 0;
           padding: 0;
           box-shadow: 0px 1px 1px 1px black;
       }
       aside{
        width: 25%;
        position: relative;
       }

       .post {
           background-color: #ffffff;
           border-radius: 8px;
           box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
           margin-bottom: 20px;
           padding: 20px;
       }
       .post-header {
           display: flex;
           align-items: center;
           margin-bottom: 15px;
       }
       .post-header img {
           width: 50px;
           height: 50px;
           border-radius: 50%;
           margin-right: 10px;
       }
       .post-header .user-info {
           display: flex;
           flex-direction: column;
       }
       .post-header .user-info .username {
           font-weight: bold;
           font-size: 16px;
       }
       .post-header .user-info .post-time {
           font-size: 14px;
           color: #666;
       }
       .post-content {
           margin-bottom: 15px;
       }
       .post-content .post-title {
           font-size: 20px;
           font-weight: bold;
           margin-bottom: 10px;
       }
       .post-content .post-text {
           font-size: 16px;
           line-height: 1.5;
           color: #333;
       }
       .post-content .recipe-image {
           max-width: 25%;
           border-radius: 8px;
           margin-top: 15px;
       }
       .post-content .recipe-details {
           margin-top: 15px;
       }
       .post-content .recipe-details h4 {
           font-size: 18px;
           margin-bottom: 10px;
       }
       .post-content .recipe-details p {
           font-size: 16px;
           line-height: 1.5;
           color: #333;
       }
       .post-content .recipe-details ul {
           padding-left: 20px;
           margin: 10px 0;
       }
       .post-content .recipe-details ul li {
           list-style-type: disc;
           margin-bottom: 5px;
       }
       .post-actions {
           display: flex;
           align-items: center;
           border-top: 1px solid #eee;
           padding-top: 15px;
       }
       .post-actions button {
           background-color: transparent;
           border: none;
           cursor: pointer;
           display: flex;
           align-items: center;
           margin-right: 20px;
           font-size: 14px;
           color: #666;
       }
       .post-actions button:hover {
           color: #333;
       }
       .post-actions button i {
           margin-right: 5px;
       }

       .comments {
              margin-top: 15px;
              padding: 10px;

       }

       .comment-input{
              width: 90%;
              padding: 10px;
              border: 1px solid #ccc;
              border-radius: 8px;
              font-size: 16px;
              margin-bottom: 10px;
       }
   </style>
   <style>
    .post img.recipe-image {
      width: 100%;
      max-height: 300px;
      object-fit: cover;
    }
    .post-header img {
      object-fit: cover;
    }
    @media (max-width: 576px) {
      .post-actions button {
        width: 100%;
        margin-bottom: 5px;
      }
    }
  </style>
  
    <link
         href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
         rel="stylesheet">   
  
</head>
<body>
   <!-- Navigation Bar -->
   <header class="header">
       <div class="logo">
           <img src="../images/logo.png" alt="logo" class="logo-img">
           Breaking Bread
       </div>
       <nav class="navegation">
           <ul class="nav-links">
               <li><a href="#">Inicio</a></li>
               <li><a href="#">Foro</a></li>
               <li><a href="#">Mi perfil</a></li>
               
           </ul>
           <div class="search-bar">
               <input type="text" placeholder="Buscar..." class="search-input">
           </div>
       </nav>
   </header>


    
    <div class="container mt-5"> 
        <div class="row">
          <main class="col-lg-8">
            <div class="card post">
              <div class="card-header d-flex align-items-center justify-content-between">
                <div class="d-flex align-items-center">
                    
                  <img id="user-image" class="ImagenComentario"  alt="Usuario">
                  <div>
                    <span class="fw-bold username">Nombre del Usuario</span><br>
                    <span class="text-muted post-time">Hace 2 horas</span>
                  </div>
                </div>
                <div>
                  <button class="hidden btn btn-warning btn-sm" id="editPostButton">Editar</button>
                  <button class="hidden btn btn-danger btn-sm" id="removePostButton">Borrar</button>
                </div>
              </div>
              <div class="card-body">
                <h2 class="post-title">Título de la Publicación</h2>
                <p class="post-text">Texto del contenido de la publicación. Este es un ejemplo de cómo se vería el texto en una publicación.</p>
                <img src="" alt="Receta" class="img-fluid rounded recipe-image">
                <div class="recipe-details mt-3">
                  <h3><strong>Receta:</strong></h3>
                  <h4 id="recipe-name"></h4>
                  <p><strong>Descripción:</strong></p>
                  <p id="recipe-description">Descripción breve de la receta.</p>
                  <p><strong>Ingredientes:</strong></p>
                  <ul id="recipe-ingredients" class="list-group list-group-flush">
                    <li class="list-group-item">Ingrediente 1</li>
                    <li class="list-group-item">Ingrediente 2</li>
                    <li class="list-group-item">Ingrediente 3</li>
                  </ul>
                  <p class="mt-3"><strong>Procedimiento:</strong></p>
                  <p id="recipe-process">Paso a paso detallado de cómo preparar la receta.</p>
                </div>
              </div>
            </div>
          </main>
          
          <aside class="col-lg-4 mt-3 mt-lg-0">
            <div class="card p-3">
              <div class="post-actions d-flex justify-content-between">
                <button id="likeButton" class="btn btn-outline-primary w-50"><i class="far fa-thumbs-up"></i> Me gusta</button>
                
              </div>
              <p id="likesAmount" class="text-center mt-2">Cantidad de likes :d</p>
              <div class="comments mt-3">
                <form id="comment-form" class="d-flex">
                  <input class="comment-input" type="text" placeholder="Escribe un comentario..." class="form-control me-2">
                  <button id="submit-button" type="submit" class="btn btn-dark">Comentar</button>
                </form>
              </div>
              <div class="listCommetns mt-3">
                <ul id="commentarios" class="list-group">
                  <!-- Comentarios aquí -->
                </ul>
              </div>
            </div>
          </aside>
        </div>
      </div>
      

  <!-- Modal -->
  <div class="modal fade" id="myModal" tabindex="-1" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="myModalLabel">¿Estás seguro?</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          ¿Quieres continuar con esta acción?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="btnNo">No</button>
          <button type="button" class="btn btn-primary" id="btnYes">Sí</button>
        </div>
      </div>
    </div>
  </div>
  

   <script>
    document.addEventListener('DOMContentLoaded', () => {
     
    const  nameUser = document.querySelector('.username');
    const  userImage = document.getElementById('user-image');
    const  postTitle = document.querySelector('.post-title');
    const  postText = document.querySelector('.post-text');
    const  recipeImage = document.querySelector('.recipe-image');
    const  recipename = document.getElementById('recipe-name');
    const  recipeDescription = document.getElementById('recipe-description');
    const  recipeIngredients = document.getElementById('recipe-ingredients');
    const  recipeProcedure = document.getElementById('recipe-process');
    

    const delateButton = document.getElementById('removePostButton');
    let id_user_post;
    const id_user_perfil = localStorage.getItem('userId');
    
    const urlParamenters = new URLSearchParams(window.location.search);
    const searchTerm = urlParamenters.get('q');
    //console.log(searchTerm);
    
    const urlPost = `http://localhost:5000/posts/info/postdata/${searchTerm}`;

    fetch(urlPost)
    .then(response => response.json())
    .then(data => {
        //console.log(data);
        id_user_post =showResults(data);
        authentication(id_user_perfil,id_user_post);
    })

    .catch(error => {
        console.error('Error fetching data:', error);
    });

    



    function showResults(data) {
        //console.table(data);
        const post = data[0];
        console.log("Esta es el path de la foto de user",post.foto_perfil)

        nameUser.textContent = post.nombre_Usuario;
        userImage.src = "/"+post.foto_perfil;
        postTitle.textContent = post.titulo;
        postText.textContent = post.texto;
        recipeImage.src = "/"+post.url_image;
        recipename.textContent = post.nombre_Receta;
        recipeDescription.textContent = post.descripcion_Reseta;
        recipeIngredients.textContent = post.ingredientes; 
        recipeProcedure.textContent = post.procedimiento;

        return post.id_user;
    }    



    delateButton.addEventListener('click', function(event)
    {   
        console.log("Se esta tratando de borrar",searchTerm,"Post ");
        
        
        event.preventDefault(); 
        
        var myModal = new bootstrap.Modal(document.getElementById('myModal'));
        myModal.show();

        const btnNo = document.getElementById("btnNo");
        const btnYes = document.getElementById("btnYes");

        btnNo.addEventListener('click',()=>
        {
            console.log("Escribio No");
        })

        btnYes.addEventListener('click',()=>
        {
            isYours(1,1,searchTerm);
            console.log("Escribio si");
        })



        
    } );

    function authentication(id_user,id_user_post)
    {
        if(id_user == id_user_post)
        {
            console.log("smos el mismo bot :d");
            delateButton.classList.remove("hidden");


        }else
        {
            console.log("No somos iguales :d id_user login:",id_user," i_user_post:",id_user_post);
        
        }
    }
    function isYours(id_user, id_user2, id_post) {   
        
        
        
        
        const urlRemove = `http://localhost:5000/posts/userActions/removePost/${id_post}`;
        
        fetch(urlRemove, {
            method: "DELETE", // Se usa DELETE para eliminar
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ id_user, id_user2 }) // Enviar los ID si son necesarios
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`Error en la solicitud: ${response.statusText}`);
            }
            return response.json();
        })
        .then(data => {
            console.log("Post removed successfully", data);
            window.location.href = "http://localhost:4200/index.html";
        })
        .catch(error => {
            console.error("Error removing post:", error);
        });
    }
    
    });

   </script>
   <script src="../js/comments.js" defer></script>
   <script src="../js/nav.js" defer></script>
   <script src="../js/actionsPost.js" defer></script>
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>